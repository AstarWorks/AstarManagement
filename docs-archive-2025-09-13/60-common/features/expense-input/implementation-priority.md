# 実費入力機能 実装優先順位

## 実装フェーズ分け

### Phase 1: コア機能（必須）
**目標**: 基本的な実費の入力・閲覧・管理ができる

#### 1-1. データベース基盤（2日）
1. Prismaスキーマ定義
2. マイグレーション実行
3. RLS設定
4. 基本的なシードデータ

#### 1-2. API基本実装（3日）
1. 実費CRUD API
   - POST /expenses（作成）
   - GET /expenses（一覧）
   - GET /expenses/:id（詳細）
   - PUT /expenses/:id（更新）
   - DELETE /expenses/:id（論理削除）
2. エラーハンドリング
3. バリデーション

#### 1-3. フロントエンド基本画面（5日）
1. Pinia Store設定
   - expense.store.ts（基本CRUD）
   - expense-filter.store.ts（フィルター）
2. 実費一覧画面
   - ExpenseListPage.vue
   - ExpenseTable.vue
   - 基本的なフィルター（日付範囲）
3. 実費入力画面（PC版）
   - ExpenseFormPage.vue
   - ExpenseDetailForm.vue
   - 基本バリデーション

### Phase 2: モバイル対応（重要）
**目標**: スマートフォンでの快適な入力体験

#### 2-1. モバイルUI実装（3日）
1. ExpenseQuickForm.vue（モバイル最適化フォーム）
2. レスポンシブデザイン調整
3. スワイプ操作
   - ExpenseSwipeActions.vue
   - useSwipeGesture.ts

#### 2-2. モバイル固有機能（2日）
1. カメラ撮影による裏付け資料追加
2. タッチ操作最適化
3. オフライン対応検討

### Phase 3: CSVインポート（重要）
**目標**: 銀行明細の効率的な取り込み

#### 3-1. CSVパース機能（2日）
1. ImportWizard.vue実装
2. CSVパーサー（PapaParse統合）
3. フォーマット自動認識

#### 3-2. インポートUI（3日）
1. テーブルモード実装
   - ImportPreviewTable.vue
   - 一括選択機能
2. カードモード実装
   - ImportCardStack.vue
   - ImportSwipeCard.vue
   - スワイプ判定UI

#### 3-3. インポートAPI（2日）
1. POST /expenses/import/parse
2. POST /expenses/import/execute
3. バッチ処理実装

### Phase 4: データ活用機能
**目標**: 入力したデータの可視化と出力

#### 4-1. 集計機能（2日）
1. GET /expenses/reports/summary API
2. ReportPage.vue
3. 基本的な集計表示

#### 4-2. エクスポート機能（2日）
1. CSVエクスポート
2. PDFエクスポート（jsPDF統合）
3. ダウンロード処理

### Phase 5: 使い勝手向上
**目標**: 日常業務での使いやすさ改善

#### 5-1. UI改善（2日）
1. 列表示カスタマイズ
2. ローディング・エラー状態
3. 空状態の表示

#### 5-2. パフォーマンス最適化（1日）
1. ページネーション実装
2. 仮想スクロール検討
3. キャッシュ戦略

## 実装順序の根拠

### なぜこの順序か？

1. **Phase 1を最優先にする理由**
   - 実費入力の基本機能がないと何も始まらない
   - PCでの基本動作確認が必要
   - APIの動作確認ができる

2. **Phase 2を2番目にする理由**
   - 実際の利用シーンはモバイルが多い
   - 外出先での即座の入力が重要
   - ユーザー体験の差別化要因

3. **Phase 3を3番目にする理由**
   - 大量データの効率的な処理は業務効率化の要
   - ただし、基本機能なしでは意味がない
   - カードモードは差別化要因

4. **Phase 4, 5を後回しにする理由**
   - データが溜まってから価値が出る機能
   - なくても基本業務は回る
   - 改善系は実際の使用感を見てから

## リスクと対策

### 技術的リスク
1. **Row Level Security (RLS)の設定ミス**
   - 対策: 十分なテストとドキュメント確認

2. **モバイルでのパフォーマンス**
   - 対策: 早期にモバイル実機テスト

3. **CSVフォーマットの多様性**
   - 対策: 主要銀行のサンプルを事前収集

### スケジュールリスク
- 総工数: 約25日
- バッファ: 各フェーズ+20%を想定
- 並行作業: API開発とフロントエンド開発は一部並行可能

## MVP完成の定義

以下ができれば実費入力機能のMVP完成とする：

1. ✅ PCで実費の入力・編集・削除ができる
2. ✅ スマートフォンで快適に入力できる
3. ✅ CSVから一括インポートできる
4. ✅ 基本的な集計が見られる
5. ✅ データをエクスポートできる

## 次のステップ

1. この優先順位でよければ、Phase 1の実装に着手
2. 他の機能（案件管理）と並行して進めるかの判断
3. 開発環境のセットアップ確認