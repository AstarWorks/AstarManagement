# å ±é…¬ç®¡ç†ç”»é¢è¨­è¨ˆ

## æ¦‚è¦

ã‚¹ãƒãƒ›ã§ã®å®Ÿè²»è¨˜éŒ²ã‚’æœ€å„ªå…ˆã«ã€çµŒè²»ç®¡ç†ã€è«‹æ±‚æ›¸ä½œæˆã¾ã§ä¸€è²«ã—ã¦ç®¡ç†ã§ãã‚‹ç”»é¢è¨­è¨ˆã€‚ä¼šè¨ˆå£«ã¨ã®ã‚„ã‚Šå–ã‚Šã‚’ã‚¹ãƒ ãƒ¼ã‚ºã«ã™ã‚‹ã“ã¨ã‚’ç¬¬ä¸€ç›®çš„ã¨ã—ã¾ã™ã€‚

## ç”»é¢æ§‹æˆ

### 1. ãƒ¡ã‚¤ãƒ³ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å ±é…¬ãƒ»çµŒè²»ç®¡ç†                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ å®Ÿè²»è¨˜éŒ² â”‚ çµŒè²»ä¸€è¦§ â”‚ è«‹æ±‚æ›¸  â”‚ ãƒ¬ãƒãƒ¼ãƒˆ â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                 â”‚
â”‚ ğŸ“± ã‚¯ã‚¤ãƒƒã‚¯å…¥åŠ›ï¼ˆã‚ˆãä½¿ã†é …ç›®ï¼‰                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”  â”‚
â”‚ â”‚ ğŸš• â”‚ â”‚ ğŸ“® â”‚ â”‚ ğŸ“„ â”‚ â”‚ ğŸšƒ â”‚ â”‚ â˜• â”‚ â”‚ â• â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜  â”‚
â”‚                                                 â”‚
â”‚ ä»Šæœˆã®é›†è¨ˆ                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ åå…¥: Â¥1,234,567  æ”¯å‡º: Â¥456,789          â”‚ â”‚
â”‚ â”‚ å·®é¡: Â¥777,778                            â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚
â”‚ æœ€è¿‘ã®è¨˜éŒ²                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 1/20 ã‚¿ã‚¯ã‚·ãƒ¼ä»£       Â¥1,200  æ¡ˆä»¶:2024-001â”‚ â”‚
â”‚ â”‚ 1/20 åå…¥å°ç´™ä»£      Â¥10,000  æ¡ˆä»¶:2024-002â”‚ â”‚
â”‚ â”‚ 1/19 äº¤é€šè²»ï¼ˆé›»è»Šï¼‰    Â¥540  æ¡ˆä»¶:2024-001â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ä½¿ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

### ã‚³ã‚¢ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- **VueUse**: ã‚«ãƒ¡ãƒ©åˆ¶å¾¡ã€ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç®¡ç†
- **@tanstack/vue-query**: APIã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°
- **floating-vue**: ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã€ãƒãƒƒãƒ—ã‚ªãƒ¼ãƒãƒ¼

### UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- **shadcn-vue**: ãƒ™ãƒ¼ã‚¹UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- **vue-sonner**: ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ï¼ˆã‚¹ãƒãƒ›å¯¾å¿œï¼‰
- **vue-number-format**: é‡‘é¡å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

### ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†
- **compressorjs**: ç”»åƒåœ§ç¸®
- **vue-cropperjs**: ç”»åƒã‚¯ãƒ­ãƒƒãƒ—ï¼ˆé ˜åæ›¸æ•´å½¢ï¼‰

### ã‚°ãƒ©ãƒ•ãƒ»ãƒ¬ãƒãƒ¼ãƒˆ
- **@vue-echarts**: é›†è¨ˆã‚°ãƒ©ãƒ•
- **jspdf**: PDFç”Ÿæˆ
- **xlsx**: Excelå‡ºåŠ›

## ã‚¿ãƒ–åˆ¥ç”»é¢è¨­è¨ˆ

### 1. å®Ÿè²»è¨˜éŒ²ã‚¿ãƒ–ï¼ˆãƒ¢ãƒã‚¤ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆï¼‰

```vue
<!-- pages/expenses/index.vue -->
<template>
  <div class="expense-page">
    <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <Tabs v-model="activeTab" class="w-full">
      <TabsList class="grid w-full grid-cols-4">
        <TabsTrigger value="quick">å®Ÿè²»è¨˜éŒ²</TabsTrigger>
        <TabsTrigger value="list">çµŒè²»ä¸€è¦§</TabsTrigger>
        <TabsTrigger value="invoice">è«‹æ±‚æ›¸</TabsTrigger>
        <TabsTrigger value="report">ãƒ¬ãƒãƒ¼ãƒˆ</TabsTrigger>
      </TabsList>
      
      <!-- å®Ÿè²»è¨˜éŒ²ã‚¿ãƒ– -->
      <TabsContent value="quick" class="space-y-6">
        <!-- ã‚¯ã‚¤ãƒƒã‚¯å…¥åŠ›ãƒœã‚¿ãƒ³ -->
        <div class="quick-input-section">
          <h3 class="text-sm font-medium mb-3">ã‚ˆãä½¿ã†é …ç›®</h3>
          <div class="grid grid-cols-3 sm:grid-cols-6 gap-3">
            <QuickExpenseButton
              v-for="template in frequentTemplates"
              :key="template.id"
              :template="template"
              @click="openQuickInput(template)"
            />
            <button
              class="quick-button add-new"
              @click="openNewExpense"
            >
              <Plus class="h-8 w-8" />
              <span>æ–°è¦</span>
            </button>
          </div>
        </div>
        
        <!-- ä»Šæœˆã®ã‚µãƒãƒªãƒ¼ -->
        <ExpenseSummaryCard :month="currentMonth" />
        
        <!-- æœ€è¿‘ã®è¨˜éŒ² -->
        <div class="recent-expenses">
          <h3 class="text-sm font-medium mb-3">æœ€è¿‘ã®è¨˜éŒ²</h3>
          <TransitionGroup name="list" tag="div" class="space-y-2">
            <ExpenseListItem
              v-for="expense in recentExpenses"
              :key="expense.id"
              :expense="expense"
              @click="editExpense(expense)"
              @delete="deleteExpense(expense)"
            />
          </TransitionGroup>
        </div>
      </TabsContent>
      
      <!-- ä»–ã®ã‚¿ãƒ– -->
      <TabsContent value="list">
        <ExpenseListView />
      </TabsContent>
      
      <TabsContent value="invoice">
        <InvoiceManagementView />
      </TabsContent>
      
      <TabsContent value="report">
        <ExpenseReportView />
      </TabsContent>
    </Tabs>
    
    <!-- ãƒ¢ãƒã‚¤ãƒ«ç”¨ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ -->
    <Transition name="fab">
      <button
        v-if="isMobile && activeTab !== 'quick'"
        class="fab"
        @click="openCameraCapture"
      >
        <Camera class="h-6 w-6" />
      </button>
    </Transition>
  </div>
</template>

<script setup lang="ts">
import { useMediaQuery } from '@vueuse/core'
import { useExpensesStore } from '~/stores/expenses'

const store = useExpensesStore()
const { frequentTemplates, recentExpenses, currentMonth } = storeToRefs(store)

const activeTab = ref('quick')
const isMobile = useMediaQuery('(max-width: 640px)')

// ã‚¯ã‚¤ãƒƒã‚¯å…¥åŠ›
const openQuickInput = (template: ExpenseTemplate) => {
  const { openModal } = useUIStore()
  openModal('quick-expense-input', { template })
}

// æ–°è¦å…¥åŠ›
const openNewExpense = () => {
  const { openModal } = useUIStore()
  openModal('expense-input')
}

// ã‚«ãƒ¡ãƒ©æ’®å½±ï¼ˆãƒ¢ãƒã‚¤ãƒ«ï¼‰
const openCameraCapture = () => {
  const { openModal } = useUIStore()
  openModal('camera-capture')
}

// åˆæœŸåŒ–
onMounted(() => {
  store.fetchTemplates()
  store.fetchExpenses()
})
</script>

<style scoped>
.quick-button {
  @apply flex flex-col items-center justify-center p-4 
         border-2 border-dashed rounded-lg
         hover:bg-accent transition-colors cursor-pointer;
  
  span {
    @apply text-xs mt-2;
  }
}

.quick-button.add-new {
  @apply border-primary/50 text-primary;
}

.fab {
  @apply fixed bottom-6 right-6 w-14 h-14 
         bg-primary text-primary-foreground
         rounded-full shadow-lg
         flex items-center justify-center
         hover:scale-110 transition-transform;
  z-index: 100;
}

/* ãƒªã‚¹ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
.list-move,
.list-enter-active,
.list-leave-active {
  transition: all 0.3s ease;
}

.list-enter-from,
.list-leave-to {
  opacity: 0;
  transform: translateX(30px);
}

.list-leave-active {
  position: absolute;
  right: 0;
  left: 0;
}

/* FABã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
.fab-enter-active,
.fab-leave-active {
  transition: all 0.3s ease;
}

.fab-enter-from,
.fab-leave-to {
  opacity: 0;
  transform: scale(0) rotate(180deg);
}
</style>
```

### 2. å®Ÿè²»å…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆã‚¹ãƒãƒ›æœ€é©åŒ–ï¼‰

```vue
<!-- components/expenses/ExpenseInputModal.vue -->
<template>
  <Dialog v-model:open="isOpen">
    <DialogContent class="expense-input-modal">
      <DialogHeader>
        <DialogTitle>{{ mode === 'edit' ? 'å®Ÿè²»ç·¨é›†' : 'å®Ÿè²»è¨˜éŒ²' }}</DialogTitle>
      </DialogHeader>
      
      <form @submit.prevent="handleSubmit" class="space-y-4">
        <!-- é‡‘é¡ï¼ˆå¤§ããè¡¨ç¤ºï¼‰ -->
        <div class="amount-input-group">
          <label class="text-sm text-muted-foreground">é‡‘é¡</label>
          <div class="amount-input">
            <span class="currency">Â¥</span>
            <input
              v-model="form.amount"
              type="tel"
              inputmode="numeric"
              pattern="[0-9]*"
              class="amount-field"
              placeholder="0"
              @input="formatAmount"
            />
          </div>
        </div>
        
        <!-- æ—¥ä»˜ -->
        <div class="form-group">
          <Label for="date">æ—¥ä»˜</Label>
          <Input
            id="date"
            v-model="form.date"
            type="date"
            :max="today"
          />
        </div>
        
        <!-- æ‘˜è¦ -->
        <div class="form-group">
          <Label for="description">æ‘˜è¦</Label>
          <Input
            id="description"
            v-model="form.description"
            placeholder="ã‚¿ã‚¯ã‚·ãƒ¼ä»£ã€å°ç´™ä»£ãªã©"
            @focus="showSuggestions = true"
          />
          
          <!-- ã‚µã‚¸ã‚§ã‚¹ãƒˆ -->
          <Transition name="slide-down">
            <div v-if="showSuggestions && suggestions.length" class="suggestions">
              <button
                v-for="suggestion in suggestions"
                :key="suggestion"
                type="button"
                class="suggestion-item"
                @click="selectSuggestion(suggestion)"
              >
                {{ suggestion }}
              </button>
            </div>
          </Transition>
        </div>
        
        <!-- æ¡ˆä»¶é¸æŠ -->
        <div class="form-group">
          <Label for="case">æ¡ˆä»¶</Label>
          <CaseCombobox
            v-model="form.caseId"
            placeholder="æ¡ˆä»¶ã‚’é¸æŠ"
          />
        </div>
        
        <!-- é ˜åæ›¸ -->
        <div class="form-group">
          <Label>é ˜åæ›¸</Label>
          <div class="receipt-area">
            <div v-if="receiptPreview" class="receipt-preview">
              <img :src="receiptPreview" alt="é ˜åæ›¸" />
              <button
                type="button"
                class="remove-receipt"
                @click="removeReceipt"
              >
                <X class="h-4 w-4" />
              </button>
            </div>
            <div v-else class="receipt-buttons">
              <button
                type="button"
                class="receipt-button"
                @click="openCamera"
              >
                <Camera class="h-5 w-5" />
                <span>æ’®å½±</span>
              </button>
              <button
                type="button"
                class="receipt-button"
                @click="selectFile"
              >
                <Upload class="h-5 w-5" />
                <span>é¸æŠ</span>
              </button>
            </div>
          </div>
          <input
            ref="fileInput"
            type="file"
            accept="image/*"
            class="hidden"
            @change="handleFileSelect"
          />
        </div>
        
        <!-- è©³ç´°ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆæŠ˜ã‚ŠãŸãŸã¿ï¼‰ -->
        <Collapsible v-model:open="showAdvanced">
          <CollapsibleTrigger class="text-sm text-muted-foreground">
            è©³ç´°ã‚ªãƒ—ã‚·ãƒ§ãƒ³
            <ChevronDown class="h-4 w-4 ml-1 inline" />
          </CollapsibleTrigger>
          <CollapsibleContent class="space-y-4 pt-4">
            <!-- æ”¯æ‰•æ–¹æ³• -->
            <div class="form-group">
              <Label>æ”¯æ‰•æ–¹æ³•</Label>
              <RadioGroup v-model="form.paymentMethod">
                <div class="flex items-center space-x-2">
                  <RadioGroupItem value="cash" id="cash" />
                  <Label for="cash">ç¾é‡‘</Label>
                </div>
                <div class="flex items-center space-x-2">
                  <RadioGroupItem value="credit" id="credit" />
                  <Label for="credit">ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆ</Label>
                </div>
                <div class="flex items-center space-x-2">
                  <RadioGroupItem value="advance" id="advance" />
                  <Label for="advance">ç«‹æ›¿</Label>
                </div>
              </RadioGroup>
            </div>
            
            <!-- ãƒ¡ãƒ¢ -->
            <div class="form-group">
              <Label for="memo">ãƒ¡ãƒ¢</Label>
              <Textarea
                id="memo"
                v-model="form.memo"
                rows="2"
                placeholder="è¿½åŠ æƒ…å ±ãŒã‚ã‚Œã°"
              />
            </div>
          </CollapsibleContent>
        </Collapsible>
        
        <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
        <div class="flex gap-2">
          <Button
            type="submit"
            class="flex-1"
            :disabled="!isValid || isSubmitting"
          >
            <Loader2 v-if="isSubmitting" class="h-4 w-4 mr-2 animate-spin" />
            {{ mode === 'edit' ? 'æ›´æ–°' : 'ä¿å­˜' }}
          </Button>
          <Button
            type="button"
            variant="outline"
            @click="close"
          >
            ã‚­ãƒ£ãƒ³ã‚»ãƒ«
          </Button>
        </div>
      </form>
    </DialogContent>
  </Dialog>
</template>

<script setup lang="ts">
import { useVModel } from '@vueuse/core'
import { useCamera } from '~/composables/useCamera'
import { useImageCompression } from '~/composables/useImageCompression'

const props = defineProps<{
  modelValue: boolean
  expense?: Expense
  template?: ExpenseTemplate
}>()

const emit = defineEmits<{
  'update:modelValue': [value: boolean]
  'submit': [data: ExpenseFormData]
}>()

const isOpen = useVModel(props, 'modelValue', emit)
const mode = computed(() => props.expense ? 'edit' : 'create')

// ãƒ•ã‚©ãƒ¼ãƒ 
const form = reactive({
  amount: props.expense?.amount || props.template?.amount || '',
  date: props.expense?.date || new Date().toISOString().split('T')[0],
  description: props.expense?.description || props.template?.description || '',
  caseId: props.expense?.caseId || '',
  paymentMethod: props.expense?.paymentMethod || 'cash',
  memo: props.expense?.memo || '',
  receiptFile: null as File | null
})

// é‡‘é¡ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
const formatAmount = (e: Event) => {
  const input = e.target as HTMLInputElement
  const value = input.value.replace(/[^\d]/g, '')
  const formatted = Number(value).toLocaleString()
  form.amount = value
  input.value = formatted
}

// ã‚µã‚¸ã‚§ã‚¹ãƒˆ
const showSuggestions = ref(false)
const suggestions = computed(() => {
  if (!form.description) return []
  
  const common = [
    'ã‚¿ã‚¯ã‚·ãƒ¼ä»£',
    'åå…¥å°ç´™ä»£',
    'äº¤é€šè²»ï¼ˆé›»è»Šï¼‰',
    'äº¤é€šè²»ï¼ˆãƒã‚¹ï¼‰',
    'ã‚³ãƒ”ãƒ¼ä»£',
    'æ›¸ç±ä»£',
    'ä¼šè­°è²»',
    'éƒµé€æ–™'
  ]
  
  return common.filter(s => 
    s.includes(form.description)
  ).slice(0, 5)
})

const selectSuggestion = (suggestion: string) => {
  form.description = suggestion
  showSuggestions.value = false
}

// é ˜åæ›¸å‡¦ç†
const receiptPreview = ref<string | null>(null)
const fileInput = ref<HTMLInputElement>()

const { openCamera: startCamera } = useCamera({
  onCapture: async (blob) => {
    const file = new File([blob], 'receipt.jpg', { type: 'image/jpeg' })
    await processReceiptFile(file)
  }
})

const selectFile = () => {
  fileInput.value?.click()
}

const handleFileSelect = async (e: Event) => {
  const input = e.target as HTMLInputElement
  const file = input.files?.[0]
  if (file) {
    await processReceiptFile(file)
  }
}

const processReceiptFile = async (file: File) => {
  // ç”»åƒåœ§ç¸®
  const { compress } = useImageCompression()
  const compressed = await compress(file, {
    maxWidth: 1200,
    maxHeight: 1200,
    quality: 0.8
  })
  
  form.receiptFile = compressed
  
  // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”Ÿæˆ
  const reader = new FileReader()
  reader.onload = (e) => {
    receiptPreview.value = e.target?.result as string
  }
  reader.readAsDataURL(compressed)
}

const removeReceipt = () => {
  form.receiptFile = null
  receiptPreview.value = null
}

// ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
const isValid = computed(() => {
  return form.amount && form.description && form.caseId
})

// é€ä¿¡
const isSubmitting = ref(false)
const handleSubmit = async () => {
  if (!isValid.value) return
  
  isSubmitting.value = true
  try {
    emit('submit', {
      ...form,
      amount: Number(form.amount)
    })
    close()
  } finally {
    isSubmitting.value = false
  }
}

const close = () => {
  isOpen.value = false
}

// ãã®ä»–ã®è¨­å®š
const today = new Date().toISOString().split('T')[0]
const showAdvanced = ref(false)
</script>

<style scoped>
.expense-input-modal {
  @apply max-w-md;
}

.amount-input-group {
  @apply space-y-2;
}

.amount-input {
  @apply flex items-center gap-2 text-3xl font-bold;
}

.currency {
  @apply text-muted-foreground;
}

.amount-field {
  @apply flex-1 bg-transparent border-0 outline-none text-right;
}

.form-group {
  @apply space-y-2;
}

.suggestions {
  @apply absolute z-10 w-full mt-1 bg-popover border rounded-md shadow-md;
}

.suggestion-item {
  @apply w-full px-3 py-2 text-left hover:bg-accent
         transition-colors text-sm;
}

.receipt-area {
  @apply border-2 border-dashed rounded-lg p-4;
}

.receipt-preview {
  @apply relative;
  
  img {
    @apply w-full h-auto rounded;
  }
}

.remove-receipt {
  @apply absolute top-2 right-2 p-1 bg-background/80 
         rounded-full border shadow-sm;
}

.receipt-buttons {
  @apply flex gap-3;
}

.receipt-button {
  @apply flex-1 flex flex-col items-center gap-2 py-4
         border rounded-lg hover:bg-accent transition-colors;
  
  span {
    @apply text-sm text-muted-foreground;
  }
}

/* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
.slide-down-enter-active,
.slide-down-leave-active {
  transition: all 0.2s ease;
}

.slide-down-enter-from,
.slide-down-leave-to {
  opacity: 0;
  transform: translateY(-10px);
}
</style>
```

### 3. çµŒè²»ä¸€è¦§ç”»é¢

```vue
<!-- components/expenses/ExpenseListView.vue -->
<template>
  <div class="expense-list-view">
    <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
    <div class="filters">
      <div class="filter-row">
        <!-- æœˆé¸æŠ -->
        <MonthPicker
          v-model="selectedMonth"
          :max="currentMonth"
        />
        
        <!-- ç¨®åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
        <Select v-model="filters.type">
          <SelectTrigger class="w-32">
            <SelectValue placeholder="ç¨®åˆ¥" />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="all">ã™ã¹ã¦</SelectItem>
            <SelectItem value="office">äº‹å‹™æ‰€çµŒè²»</SelectItem>
            <SelectItem value="personal">å€‹äººçµŒè²»</SelectItem>
            <SelectItem value="case">æ¡ˆä»¶å®Ÿè²»</SelectItem>
          </SelectContent>
        </Select>
        
        <!-- ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ -->
        <Button
          variant="outline"
          size="sm"
          @click="exportExpenses"
        >
          <Download class="h-4 w-4 mr-2" />
          CSVå‡ºåŠ›
        </Button>
      </div>
      
      <!-- é›†è¨ˆè¡¨ç¤º -->
      <div class="summary-cards">
        <SummaryCard
          label="åå…¥"
          :value="summary.income"
          trend="+12%"
          color="green"
        />
        <SummaryCard
          label="æ”¯å‡º"
          :value="summary.expense"
          trend="-5%"
          color="red"
        />
        <SummaryCard
          label="å·®é¡"
          :value="summary.balance"
          :trend="summary.balanceTrend"
          :color="summary.balance >= 0 ? 'blue' : 'red'"
        />
      </div>
    </div>
    
    <!-- çµŒè²»ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ï¼‰ -->
    <div v-if="!isMobile" class="expense-table">
      <Table>
        <TableHeader>
          <TableRow>
            <TableHead class="w-24">æ—¥ä»˜</TableHead>
            <TableHead>æ‘˜è¦</TableHead>
            <TableHead>æ¡ˆä»¶</TableHead>
            <TableHead>å‹˜å®šç§‘ç›®</TableHead>
            <TableHead class="text-right">é‡‘é¡</TableHead>
            <TableHead class="w-20">é ˜åæ›¸</TableHead>
            <TableHead class="w-20"></TableHead>
          </TableRow>
        </TableHeader>
        <TableBody>
          <TableRow
            v-for="expense in paginatedExpenses"
            :key="expense.id"
            class="cursor-pointer hover:bg-muted/50"
            @click="editExpense(expense)"
          >
            <TableCell>{{ formatDate(expense.date) }}</TableCell>
            <TableCell>{{ expense.description }}</TableCell>
            <TableCell>
              <span class="text-sm text-muted-foreground">
                {{ expense.caseNumber }}
              </span>
            </TableCell>
            <TableCell>{{ expense.accountName }}</TableCell>
            <TableCell class="text-right font-mono">
              Â¥{{ expense.amount.toLocaleString() }}
            </TableCell>
            <TableCell>
              <Paperclip 
                v-if="expense.hasReceipt" 
                class="h-4 w-4 text-muted-foreground" 
              />
            </TableCell>
            <TableCell>
              <DropdownMenu>
                <DropdownMenuTrigger asChild>
                  <Button variant="ghost" size="icon" class="h-8 w-8">
                    <MoreHorizontal class="h-4 w-4" />
                  </Button>
                </DropdownMenuTrigger>
                <DropdownMenuContent align="end">
                  <DropdownMenuItem @click.stop="editExpense(expense)">
                    ç·¨é›†
                  </DropdownMenuItem>
                  <DropdownMenuItem @click.stop="duplicateExpense(expense)">
                    è¤‡è£½
                  </DropdownMenuItem>
                  <DropdownMenuSeparator />
                  <DropdownMenuItem 
                    @click.stop="deleteExpense(expense)"
                    class="text-destructive"
                  >
                    å‰Šé™¤
                  </DropdownMenuItem>
                </DropdownMenuContent>
              </DropdownMenu>
            </TableCell>
          </TableRow>
        </TableBody>
      </Table>
      
      <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
      <Pagination
        v-model:page="currentPage"
        :total="filteredExpenses.length"
        :per-page="perPage"
      />
    </div>
    
    <!-- çµŒè²»ãƒªã‚¹ãƒˆï¼ˆãƒ¢ãƒã‚¤ãƒ«ï¼‰ -->
    <div v-else class="expense-cards">
      <ExpenseCard
        v-for="expense in paginatedExpenses"
        :key="expense.id"
        :expense="expense"
        @click="editExpense(expense)"
        @delete="deleteExpense(expense)"
      />
      
      <!-- ã‚‚ã£ã¨è¦‹ã‚‹ -->
      <Button
        v-if="hasMore"
        variant="outline"
        class="w-full"
        @click="loadMore"
      >
        ã‚‚ã£ã¨è¦‹ã‚‹
      </Button>
    </div>
  </div>
</template>

<script setup lang="ts">
import { useMediaQuery } from '@vueuse/core'
import { format } from 'date-fns'
import { ja } from 'date-fns/locale'

const store = useExpensesStore()
const { filteredExpenses, monthlyTotal, byCategory } = storeToRefs(store)

const isMobile = useMediaQuery('(max-width: 768px)')
const selectedMonth = ref(store.currentMonth)
const filters = reactive({
  type: 'all',
  accountCode: null,
  search: ''
})

// æœˆå¤‰æ›´æ™‚
watch(selectedMonth, (month) => {
  store.setCurrentMonth(month)
})

// é›†è¨ˆ
const summary = computed(() => {
  const income = filteredExpenses.value
    .filter(e => e.accountCode === 'sales')
    .reduce((sum, e) => sum + e.amount, 0)
    
  const expense = filteredExpenses.value
    .filter(e => e.accountCode !== 'sales')
    .reduce((sum, e) => sum + e.amount, 0)
    
  const balance = income - expense
  
  return {
    income,
    expense,
    balance,
    balanceTrend: balance >= 0 ? '+' : '-'
  }
})

// ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³
const currentPage = ref(1)
const perPage = 20
const mobileLimit = ref(10)

const paginatedExpenses = computed(() => {
  if (isMobile.value) {
    return filteredExpenses.value.slice(0, mobileLimit.value)
  }
  
  const start = (currentPage.value - 1) * perPage
  return filteredExpenses.value.slice(start, start + perPage)
})

const hasMore = computed(() => 
  isMobile.value && mobileLimit.value < filteredExpenses.value.length
)

const loadMore = () => {
  mobileLimit.value += 10
}

// æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
const formatDate = (date: string) => {
  return format(new Date(date), 'M/d(E)', { locale: ja })
}

// ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
const exportExpenses = async () => {
  const { exportToCSV } = useExpenseExport()
  await exportToCSV(filteredExpenses.value, selectedMonth.value)
}

// ç·¨é›†ãƒ»å‰Šé™¤
const editExpense = (expense: Expense) => {
  const { openModal } = useUIStore()
  openModal('expense-input', { expense })
}

const duplicateExpense = (expense: Expense) => {
  const { openModal } = useUIStore()
  const duplicate = { ...expense, id: undefined, date: new Date().toISOString().split('T')[0] }
  openModal('expense-input', { expense: duplicate })
}

const deleteExpense = async (expense: Expense) => {
  if (await confirm('ã“ã®çµŒè²»ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
    await store.deleteExpense(expense.id)
  }
}
</script>
```

### 4. è«‹æ±‚æ›¸ä½œæˆç”»é¢

```vue
<!-- components/expenses/InvoiceManagementView.vue -->
<template>
  <div class="invoice-management">
    <!-- ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ -->
    <div class="toolbar">
      <h2 class="text-lg font-semibold">è«‹æ±‚æ›¸ç®¡ç†</h2>
      <Button @click="createInvoice">
        <Plus class="h-4 w-4 mr-2" />
        è«‹æ±‚æ›¸ä½œæˆ
      </Button>
    </div>
    
    <!-- è«‹æ±‚æ›¸ä¸€è¦§ -->
    <div class="invoice-list">
      <div
        v-for="invoice in invoices"
        :key="invoice.id"
        class="invoice-card"
        @click="openInvoice(invoice)"
      >
        <div class="invoice-header">
          <div>
            <div class="invoice-number">{{ invoice.invoiceNumber }}</div>
            <div class="invoice-client">{{ invoice.clientName }}</div>
          </div>
          <Badge :variant="getStatusVariant(invoice.status)">
            {{ getStatusLabel(invoice.status) }}
          </Badge>
        </div>
        
        <div class="invoice-details">
          <div class="detail-item">
            <span class="label">ç™ºè¡Œæ—¥</span>
            <span>{{ formatDate(invoice.issueDate) }}</span>
          </div>
          <div class="detail-item">
            <span class="label">æ”¯æ‰•æœŸé™</span>
            <span>{{ formatDate(invoice.dueDate) }}</span>
          </div>
          <div class="detail-item">
            <span class="label">é‡‘é¡</span>
            <span class="amount">Â¥{{ invoice.totalAmount.toLocaleString() }}</span>
          </div>
        </div>
        
        <div class="invoice-actions">
          <Button
            variant="outline"
            size="sm"
            @click.stop="downloadPDF(invoice)"
          >
            <FileText class="h-4 w-4 mr-2" />
            PDF
          </Button>
          <Button
            v-if="invoice.status === 'draft'"
            size="sm"
            @click.stop="sendInvoice(invoice)"
          >
            é€ä¿¡
          </Button>
          <Button
            v-else-if="invoice.status === 'sent'"
            variant="outline"
            size="sm"
            @click.stop="recordPayment(invoice)"
          >
            å…¥é‡‘è¨˜éŒ²
          </Button>
        </div>
      </div>
    </div>
  </div>
</template>
```

## ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒãƒ¼ã‚¶ãƒ–ãƒ«

```typescript
// composables/useCamera.ts
export const useCamera = (options: {
  onCapture: (blob: Blob) => void
}) => {
  const { isSupported, stream } = useUserMedia({
    constraints: {
      video: {
        facingMode: 'environment' // èƒŒé¢ã‚«ãƒ¡ãƒ©
      }
    }
  })
  
  const videoRef = ref<HTMLVideoElement>()
  const canvasRef = ref<HTMLCanvasElement>()
  
  const openCamera = () => {
    const { openModal } = useUIStore()
    openModal('camera-capture', {
      onCapture: capture
    })
  }
  
  const capture = () => {
    if (!videoRef.value || !canvasRef.value) return
    
    const video = videoRef.value
    const canvas = canvasRef.value
    const ctx = canvas.getContext('2d')!
    
    canvas.width = video.videoWidth
    canvas.height = video.videoHeight
    ctx.drawImage(video, 0, 0)
    
    canvas.toBlob((blob) => {
      if (blob) {
        options.onCapture(blob)
      }
    }, 'image/jpeg', 0.9)
  }
  
  return {
    isSupported,
    openCamera,
    videoRef,
    canvasRef,
    capture
  }
}

// composables/useExpenseExport.ts
export const useExpenseExport = () => {
  const exportToCSV = async (expenses: Expense[], month: string) => {
    const headers = [
      'æ—¥ä»˜',
      'æ‘˜è¦',
      'æ¡ˆä»¶ç•ªå·',
      'å‹˜å®šç§‘ç›®',
      'é‡‘é¡',
      'æ¶ˆè²»ç¨',
      'æºæ³‰å¾´å',
      'æ”¯æ‰•æ–¹æ³•',
      'ãƒ¡ãƒ¢'
    ]
    
    const rows = expenses.map(e => [
      e.date,
      e.description,
      e.caseNumber || '',
      e.accountName,
      e.amount,
      e.taxAmount || 0,
      e.withholdingAmount || 0,
      e.paymentMethod,
      e.memo || ''
    ])
    
    // CSVç”Ÿæˆ
    const csv = [
      headers.join(','),
      ...rows.map(row => 
        row.map(cell => 
          typeof cell === 'string' && cell.includes(',') 
            ? `"${cell}"` 
            : cell
        ).join(',')
      )
    ].join('\n')
    
    // BOMä»˜ãUTF-8ã§å‡ºåŠ›ï¼ˆExcelå¯¾å¿œï¼‰
    const bom = new Uint8Array([0xEF, 0xBB, 0xBF])
    const blob = new Blob([bom, csv], { type: 'text/csv;charset=utf-8' })
    
    // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
    const url = URL.createObjectURL(blob)
    const a = document.createElement('a')
    a.href = url
    a.download = `çµŒè²»æ˜ç´°_${month}.csv`
    a.click()
    URL.revokeObjectURL(url)
    
    // é€šçŸ¥
    const { showToast } = useUIStore()
    showToast({
      type: 'success',
      title: 'ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Œäº†',
      description: 'CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ'
    })
  }
  
  const exportToExcel = async (month: string) => {
    // Excelå½¢å¼ã§ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
    const { data } = await $fetch('/api/v1/reports/monthly-export', {
      method: 'POST',
      body: {
        year: parseInt(month.split('-')[0]),
        month: parseInt(month.split('-')[1]),
        format: 'excel'
      }
    })
    
    // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‡¦ç†
    window.location.href = data.downloadUrl
  }
  
  return {
    exportToCSV,
    exportToExcel
  }
}
```

## ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ–

### 1. ã‚¿ãƒƒãƒæ“ä½œæœ€é©åŒ–
```typescript
// ã‚¹ãƒ¯ã‚¤ãƒ—ã§å‰Šé™¤
const { lengthX } = useSwipe(elementRef, {
  onSwipeEnd() {
    if (lengthX.value < -100) {
      deleteExpense()
    }
  }
})
```

### 2. ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ
```typescript
// ä¸€æ™‚ä¿å­˜æ©Ÿèƒ½
const { save, restore } = useLocalStorage('expense_draft', {})

// å…¥åŠ›ä¸­ã®è‡ªå‹•ä¿å­˜
watchDebounced(
  form,
  () => save(form),
  { debounce: 1000 }
)
```

### 3. ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ã‚¨ãƒ³ãƒãƒ³ã‚¹ãƒ¡ãƒ³ãƒˆ
```vue
<!-- æ®µéšçš„ãªæ©Ÿèƒ½è¿½åŠ  -->
<div class="receipt-input">
  <!-- åŸºæœ¬: ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ -->
  <input type="file" accept="image/*" />
  
  <!-- æ‹¡å¼µ: ã‚«ãƒ¡ãƒ©æ’®å½± -->
  <button v-if="isCameraSupported" @click="openCamera">
    ã‚«ãƒ¡ãƒ©ã§æ’®å½±
  </button>
  
  <!-- é«˜åº¦: OCRæ©Ÿèƒ½ -->
  <button v-if="isOCREnabled" @click="scanReceipt">
    é ˜åæ›¸ã‚’ã‚¹ã‚­ãƒ£ãƒ³
  </button>
</div>
```

## ã¾ã¨ã‚

ã“ã®å ±é…¬ç®¡ç†ç”»é¢è¨­è¨ˆã«ã‚ˆã‚Šï¼š

1. **ãƒ¢ãƒã‚¤ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ**: ã‚¹ãƒãƒ›ã§ã®å®Ÿè²»è¨˜éŒ²ã‚’æœ€å„ªå…ˆ
2. **åŠ¹ç‡çš„ãªå…¥åŠ›**: ã‚¯ã‚¤ãƒƒã‚¯å…¥åŠ›ã¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ©Ÿèƒ½
3. **ä¼šè¨ˆé€£æº**: CSV/Excelå‡ºåŠ›ã§ä¼šè¨ˆå£«ã¨ã®é€£æº
4. **è¦–è¦šçš„ãªç®¡ç†**: ã‚°ãƒ©ãƒ•ã¨é›†è¨ˆã§åæ”¯ã‚’æŠŠæ¡
5. **ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãªè«‹æ±‚**: å®Ÿè²»ã‹ã‚‰è«‹æ±‚æ›¸ä½œæˆã¾ã§ä¸€è²«ç®¡ç†