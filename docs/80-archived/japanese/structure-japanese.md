# structure-japanese

### 1. 背景・目的の明確化

#### なぜ本システムを導入するのか（業務課題、DX目的）

* 現在、法律事務所における案件や書類の管理が、スプレッドシート、NAS、Google Drive、紙媒体など複数の独立した場所に分散しており、連携されていない。
* 裁判所、銀行、他の法律事務所とのやり取りを依然として紙で行っており、業務上紙媒体が残り続ける。
* 案件の進捗状況は、事務員との対面ミーティングや視認性の低いExcelシートで管理されており、リアルタイムな把握が困難。
* 業務遂行は原則として事務所内でしか行えず、リモート対応が難しい。
* 依頼者との打ち合わせ内容や電話問い合わせ内容の記録が不十分で、情報の抜け漏れが発生している。
* 実費・日当など、弁護士特有の細かい会計情報の記録と集計が煩雑で、業務負担となっている。
* 複数の資料を参照しながら、定型的な文書を作成する作業が多く、非効率である。

#### ステークホルダー

* 弁護士（業務遂行者）
* 事務員（補助業務・会計処理）

#### 成果として得たい状態

* 案件、文書、会計、連絡履歴など、事務所内のすべての情報を一元的に管理し、AI検索によって即時にアクセスできる状態。
* 案件の進捗を可視化し、所内外でのステータス共有を容易にする。
* 弁護士が手元のスマートフォンから簡易メモを記録し、その情報も検索対象として活用可能とする。
* 弁護士および事務所の収支情報の入出力を効率的に記録・分析できる環境の整備。

### 2. 現状業務の棚卸し（As-Is 分析）

#### 既存業務プロセスの洗い出し

* 事件の進捗管理はExcelのシートで行われており、案件ごとに別シートを作成して対応。
* 顧客連絡は主に電話・メール・FAXで行われている。
* 電話連絡時のメモは紙で記録しており、情報の蓄積が難しい。
* 事務員との情報共有はLINEを用いて行われており、履歴の整理が困難。
* 実費や日当の記録は、弁護士や事務員がそれぞれ紙のメモ帳等で個別に記録している。

#### 既存ツールの特定と課題の抽出

* スプレッドシート（Excel, Google Sheets）：フォーマットが統一されておらず、進捗の視認性が低い。
* Wordファイル／PDF（NASに保管）：バージョン管理が曖昧で、検索性に乏しい。
* メール：情報が分散し、履歴の追跡が困難。
* 紙媒体：証拠・連絡内容の物理的保管により業務効率が低下。

#### 非定型処理と定型処理の分類

* 非定型処理：

    * 依頼者との打ち合わせ・ヒアリング
    * 判例の調査および判例の起案作業

* 定型処理：

    * 証拠に基づく定型的な書類作成（訴状、答弁書など）
    * 銀行・役所等への申請書類の作成
    * 委任状の作成や日当・実費の整理
    * 会計データの月次集計および会計士への提出（例：事件記録管理、顧客連絡、進捗共有）

* 既存ツール（Excel、LINE、メール、物理ファイル）の特定と課題の抽出

* 非定型処理と定型処理の分類

### 3. あるべき姿の設計（To-Be）

#### 新しい業務プロセスの姿を設計

* 案件の進捗状況やボトルネックをボードUI上で直感的に確認可能とする。
* 紙で受領した書類は即時にPDF化され、OCRによって検索可能な状態で保存。必要時にすぐ参照できる。
* 顧客との連絡（電話・メール）や事務員間の連絡は、Slack/LINE/Discordなどの外部ツールと連携し、発言や履歴をシステム側で収集・記録する。
* PDFから構造化情報を抽出し、あらかじめ定義されたフォーマットに自動転写することで、定型書類の作成を高速化。
* 事件に関する情報はAIチャットを通じて照会可能。

    * 例：「この事件、どこで止まってる？」「〇〇さんって誰？」などの自然言語質問に即応。
* システム操作はGUIだけでなく、AIエージェント経由でも可能とし、内部的にCLIやMCPサーバー等のAPIに委譲されることで、柔軟な操作性を提供。

    * 例：「この資料を作って」と指示すれば自動生成が開始される。

#### その中でITが担う役割と手作業が残る領域を明確に

* **ITが担う役割**：

    * 紙・PDF書類からの情報抽出（OCR、構造化）
    * 抽出情報を元にしたテンプレート文書の自動生成
    * 案件進捗管理およびSLAベースのリマインド通知
    * 依頼者とのやり取りのログ記録・要約・インデックス化
    * 実費・日当などの会計情報の記録と帳票出力

* **まだ手作業として残る領域**：

    * 役所・銀行・他事務所への紙媒体での書類送付や押印業務
    * 紙文書のスキャン（自動スキャナー操作など）と初期登録処理

* 新しい業務プロセスの姿を設計

* その中でITが担う役割と手作業が残る領域を明確に

* 例：Slack/Discordを用いた連絡、タスク可視化UI、RAGによる検索機能

### 4. 機能要件（Functional Requirements）定義

#### 4.1 MVP スコープ（初期リリースで必須）

* **認証・2FA**：ログイン、リフレッシュ、ログアウト
* **Discord‑式 RBAC**：弁護士／事務員／依頼者の 3 ロールと基本 CRUD パーミッション
* **案件管理 (Matter)**：事件 CRUD、進捗カンバン（列移動・日時記録）
* **ドキュメント管理**：手動アップロード、PDF ビューア、OCR→全文インデックス
* **依頼者／社内メモ**：登録・一覧・検索
* **実費・日当管理**：記録・CSV エクスポート
* **キーワード検索**：全文＋メモ＋事件名
* **期日リマインド通知**：メール or Slack Webhook
* **REST API (OpenAPI)**：上記機能を公開
* **PostgreSQL 15**：トランザクション DB
* **CI/CD**：GitHub Actions ユニット＋統合テスト、ArgoCD デプロイ
* **i18n**：日本語／英語切替

#### 4.2 フェーズ 2 以降（MVP 外）

* ベクトル検索 (pgvector / OpenSearch) ＋ RAG AI チャット
* NAS／SharePoint ウォッチャー + 自動スキャン取込
* YAML テンプレ＋LLM 文書自動生成
* Kafka / NATS によるイベント駆動化
* AI サジェスト（次タスク提案・条項抽出）
* オンプレ自動インストーラ（k3s + MinIO + Harbor）
* 多言語追加（中・韓など）
* 監査ログ長期 WORM 保管最適化
* 分散トレースフルダッシュボード
* Tauri 自動アップデータ（差分更新＋署名）

---

#### 4.3 中核機能

* 進捗管理ダッシュボード（カンバン形式、ボトルネックの可視化、通知連携）
* NAS連携（SMB接続、ディレクトリ監視、ファイルイベント検知）
* 軽量かつ高速なファイルビューワ（PDFビュー、次ファイルへの瞬間遷移）
* ドキュメントOCR（PDF/A対応、画像変換、テキスト抽出）
* 依頼者とのやり取りメモ管理／全文検索（チャット履歴・電話メモの構造化）
* 実費・日当メモの記録／検索／会計帳票の出力（CSV・PDF形式）
* ベクトル検索（pgvector／FAISS）による意味検索
* ElasticSearchによる全文インデックス化と高速照会
* RAG（Retrieval-Augmented Generation）によるAI応答支援
* 通知機能（Slack・LINE等とのWebhook連携、SLAベース通知）
* テンプレ書類作成機能（yaml形式の定義に基づくWord/PDF生成）
* PDFスキャナー連携（既存ハードを前提とした自動取り込み／分類）

#### 優先度：低（将来的拡張機能）

* 自然言語による機能リクエスト → AIが自動でスクリプト・構成を生成
* 上流レイヤ（開発元）と競合しないローカルバージョン管理の導入
* gitベースの履歴管理とAIエージェントによる構成管理の統合
* 実現すべき機能単位での一覧化と要件化
* 例：ドキュメントOCR、ボードでの進捗管理、自然文検索、通知機能など

### 5. 非機能要件（Non-Functional Requirements）定義 非機能要件（Non-Functional Requirements）定義

#### セキュリティ要件

* アカウントには二段階認証（2FA）を必須とする。
* 全ての操作・アクセスは監査ログに記録し、一定期間保持する。
* 書類をクラウドにアップロードする際は、保存時にAES等で暗号化を行う。

#### パフォーマンス要件

* 書類ビューアによる表示は、1秒以下での初期表示を保証する。
* UI操作（ボタンクリックや画面遷移）は、ノータイムに近い体感速度を確保。
* 障害対応体制について：

    * クラウド環境下では、使用するクラウド（例：AWS, GCP）と同等の復旧能力・高可用性を前提とする。
    * オンプレミス導入時には、ベストエフォートで構築・運用するが、SLAは適用しない旨を事前に説明する。

#### スケーラビリティ／可用性

* Kubernetes およびマイクロサービスアーキテクチャを採用し、将来的なスケールに対応。
* SLA（可用性目標）はクラウドサービスと同期し、99.9%以上の稼働率を想定。
* オンプレミスでの導入時は、技術的サポートは提供するが、可用性の保証は行わず、説明責任にとどめる。

#### 国際化 (i18n)

* すべての UI テキスト・通貨・日付フォーマットは多言語対応を前提とし、クライアント側でランタイム切り替えが可能。
* 初期リリースでは **日本語 / 英語** をサポートし、追加言語は i18next / Next‑Intl 等で拡張可能とする。
* Kubernetes とマイクロサービス構成により、水平スケーラビリティを確保。
* クラウド構成時は、サービス可用性SLA（99.9%以上）に同期して稼働。
* オンプレミス構成時には、事務所と事前合意の上で構築し、安定性を担保するが、明示的なSLAや稼働率保証は行わない。

#### セキュリティ要件

* アカウントには二段階認証（2FA）を必須とする。
* 全ての操作・アクセスは監査ログに記録し、一定期間保持する。
* 書類をクラウドにアップロードする際は、保存時にAES等で暗号化を行う。

#### パフォーマンス要件

* 書類ビューアによる表示は、1秒以下での初期表示を保証する。
* UI操作（ボタンクリックや画面遷移）はユーザーに遅延を感じさせない即応性を重視。
* 障害対応体制はクラウド運用時においては、利用するクラウドサービス（例：AWS, GCP）と同等の可用性と復旧体制を前提とする。
* オンプレミス構成の場合、可用性・耐障害性の保証は行わず、ベストエフォートとし、事前説明を行う。

#### スケーラビリティ／可用性

* Kubernetes およびマイクロサービスアーキテクチャを採用し、将来的なスケールに対応。
* SLA（可用性目標）はクラウドサービスと同期し、99.9%以上の稼働率を想定。
* オンプレミスでの導入時は、技術的サポートは提供するが、可用性の保証は行わず、説明責任にとどめる。
* セキュリティ要件（RBAC、暗号化、監査ログ）
* パフォーマンス（応答時間、耐障害性）
* スケーラビリティ、可用性（SLA含む）

### 6. ユースケース定義

#### UC-01：依頼者・関係者からの連絡対応

* 電話や面談での相談が発生した場合、スマートフォンやPCから即座にメモを記録。
* 時刻や話題、関係人物等をタグとして紐づけて保存。
* メモは自動で全文検索対象に登録。

#### UC-02：実費・日当の発生記録

* 外出中でもスマートフォンで金額、発生日時、摘要メモ、裏付け資料（写真やPDF）を即時に記録・アップロード。
* 月次・事件別に集計可能な形式で保管され、後から帳票化可能。

#### UC-03：進捗報告と可視化

* 書類の作成が完了すると、ステータスが自動でダッシュボードに反映される。
* 銀行送付や他事務所への郵送等、外部同期できないタスクは事務員が手動登録。
* 進捗は弁護士・依頼者に共有され、依頼者アカウントは料金体系に影響しない形でアクセス提供。
* 可視化にはダッシュボードと進行バーを使用し、詰まりポイントや完了済書類を即座に確認可能。

#### UC-04：文書生成

* 事件に応じたテンプレ書類を、受領した裁判所・依頼者のPDF等を参照しつつ、自動で生成。
* 必要に応じてAIがプレフィルし、レビュー後に出力。

#### UC-05：通知とリマインダー

* 事件の進行に問題があった場合（未処理、SLA超過など）、または期日が近い場合、SlackやDiscordへリマインド通知を自動送信。
* 通知対象・頻度は事前にロール別に設定可能。

---

### 8. 制約事項・前提条件

* **クラウド／オンプレ両対応方針**：GCP 上での SaaS 提供をベースとしつつ、オンプレミスでも同一アーキテクチャを再現できるよう **クラウド固有サービスへの依存を極力排除** する。マネージドサービスを利用する場合でも、代替 OSS を明示し Infrastructure as Code で切替可能とする。

* **インフラ構成（代表例）**

    * **コンテナオーケストレーション**：

        * GCP：GKE
        * オンプレ：RKE2 / k3s など CNCF 準拠ディストリビューション
    * **オブジェクトストレージ**：

        * GCP：Cloud Storage
        * オンプレ：MinIO / Ceph RGW
    * **データベース**：

        * 共通：PostgreSQL 15 (pgvector 拡張)
        * GCP では Cloud SQL for PostgreSQL / AlloyDB、オンプレは自己管理 PostgreSQL + Patroni 高可用構成
    * **コンテナレジストリ**：

        * GCP：Artifact Registry
        * オンプレ：Harbor（OCI 準拠）

* **Infrastructure as Code**：

    * **Terraform** を公式採用し、GCP・オンプレ双方を `modules` 抽象化で単一コードベース管理
    * アプリケーションデプロイは **Helm** + **ArgoCD** の GitOps パイプラインとし、Terraform → ArgoCD 流れを CI で自動連鎖

* **パッケージマネージャ／ビルド**：JavaScript／TypeScript は **Bun** を採用し、Next.js と Tauri で共通利用

* **CI/CD パイプライン**：

    * **GitHub Actions**：ユニットテスト、SBOM、コンテナイメージビルド、OpenAPI / Proto Lint を実行
    * **ArgoCD**：ステージング・本番・オンプレ各クラスターへ GitOps デプロイ

* **既存インフラ制約**：NAS ストレージ（SMB v3）、OCR API リージョン（Tokyo/East Japan）は従来通り

* **サポート範囲**：オンプレ導入時は前述 OSS 構成を推奨テンプレートとして提供し、可用性保証はベストエフォート### 9. リスクと対策

* 技術面、運用面のリスクを明確化し、緩和策を事前定義

### 10. 受入基準とテスト方針

* 機能テストは **ユニット → 統合 → E2E** の 3 レイヤを採用し、CI パイプラインに組み込む。

    * *ユニット*: クラス／サービス単位のロジック検証 (Junit5, Vitest)
    * *統合*: DB, MQ, 外部API を含むコンテナ環境での SpringBootTest / Playwright Component Test
    * *E2E*: ブラウザ自動操作 (Playwright) ＋ Tauri アプリ自動操作でユーザシナリオ全体を検証
* 性能テスト、精度テスト（OCR、検索、通知タイミング）はステージング環境で定期実行し、SLO 達成をゲート条件とする。
* 受入条件は "必須機能完了 + SLO 満足 + セキュリティスキャン 0 Critical" を合格基準とする。

### 11. 権限モデル

* RBAC は **Discord‑ライクなロール + パーミッション** 方式を採用し、ロール名・階層は管理画面でカスタム可能とする。
* デフォルト提供ロール（削除不可）

    * **弁護士**: 事件フルアクセス・証拠編集・進捗更新・依頼者閲覧
    * **事務員**: 事件閲覧・会計入力・進捗編集（一部）・証拠閲覧
    * **依頼者**: 自事件閲覧のみ（読み取り専用）、メモ投稿、証拠アップロード
* パーミッション粒度は CRUD＋エクスポート＋設定変更の 6 カテゴリをベースに、リソースごとに細分化。
* ロール変更・招待は監査ログ対象とし、GUI と REST API の双方で操作可能。
