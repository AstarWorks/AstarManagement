# 事件管理機能 詳細設計書

## 1. 機能概要

事件管理機能は、法律事務所における案件（事件）の一元管理を実現する中核機能です。案件の作成から完了まで、全てのライフサイクルを管理し、進捗の可視化、関連情報の統合、効率的な案件処理を支援します。

## 2. ビジネス要求

### 2.1 主要な課題
- 案件情報が複数のツール・ファイルに分散
- 進捗状況の把握が困難
- 案件ごとの関連情報（書類、連絡履歴など）の紐付けが不十分
- 担当者間での情報共有が非効率

### 2.2 期待される効果
- 案件情報の一元管理による検索性向上
- リアルタイムでの進捗把握
- 効率的な情報共有と協働
- 意思決定の迅速化

## 3. 機能要件

### 3.1 案件管理（CRUD）

#### 3.1.1 案件作成
**入力項目**
- 案件番号（自動採番 or 手動入力）
- 案件名
- 案件種別（民事/刑事/家事/企業法務など）
- 依頼者情報
- 相手方情報
- 受任日
- 事案概要
- 担当弁護士（複数選択可）
- 担当事務員（複数選択可）

**ビジネスルール**
- 案件番号は年度＋連番（例：2024-001）
- 依頼者情報は必須
- 担当弁護士は最低1名必須
- 受任日は過去日付のみ許可

#### 3.1.2 案件検索・一覧
**検索条件**
- フリーワード検索（案件名、依頼者名、相手方名）
- 案件種別
- ステータス
- 担当者
- 期間（受任日、終了日）
- タグ

**一覧表示項目**
- 案件番号
- 案件名
- 依頼者名
- 現在のステータス
- 担当弁護士
- 最終更新日
- 期限アラート

**ソート・フィルター**
- 更新日時（新しい順/古い順）
- 案件番号
- ステータス別グルーピング

#### 3.1.3 案件詳細表示
**表示内容**
- 基本情報（全項目）
- ステータス履歴（タイムライン形式）
- 関連書類リスト
- コミュニケーション履歴
- タスクリスト
- メモ・備考

#### 3.1.4 案件更新
- 全項目の編集可能
- 変更履歴の自動記録
- 変更理由の入力（任意）

#### 3.1.5 案件終了・アーカイブ
- 終了日の記録
- 終了理由の選択（和解/判決/取下げなど）
- アーカイブ後も参照は可能

### 3.2 カンバンボード機能

#### 3.2.1 ボード構成
**デフォルトステータス**
1. 受任前相談
2. 受任手続中
3. 準備中
4. 進行中
5. 和解交渉中
6. 判決待ち
7. 完了
8. 保留

**カスタマイズ**
- ステータスの追加・編集・削除
- ステータス順序の変更
- ステータスごとの色設定

#### 3.2.2 カード表示
**カード情報**
- 案件番号・案件名
- 依頼者名（イニシャル表示可）
- 担当者アバター
- 期限表示（締切が近い場合は強調）
- 優先度インジケーター
- 未読通知バッジ

#### 3.2.3 ドラッグ&ドロップ
- カードのステータス間移動
- 移動時の確認ダイアログ（オプション）
- 移動履歴の記録
- 権限に基づく移動制限

#### 3.2.4 フィルター・ビュー
- 担当者別フィルター
- 案件種別フィルター
- 期限によるフィルター
- 個人ビューの保存

### 3.3 進捗管理

#### 3.3.1 マイルストーン設定
**設定可能項目**
- マイルストーン名
- 予定日
- 完了条件
- 担当者
- 関連タスク

**プリセットマイルストーン**
- 訴状提出
- 第1回口頭弁論
- 証拠提出期限
- 和解期日
- 判決期日

#### 3.3.2 タスク管理
**タスク項目**
- タスク名
- 詳細説明
- 担当者
- 期限
- 優先度（高/中/低）
- ステータス（未着手/進行中/完了）
- 添付ファイル

**タスク機能**
- サブタスクの作成
- 繰り返しタスクの設定
- タスクテンプレート
- 一括操作（複数選択）

#### 3.3.3 期限管理
**アラート種別**
- 法定期限（上訴期限など）
- 裁判所指定期限
- 内部期限
- リマインダー

**通知設定**
- 通知タイミング（3日前、1週間前など）
- 通知方法（画面内/メール）
- エスカレーション設定

### 3.4 関連情報管理

#### 3.4.1 書類管理連携
- 案件に紐づく書類の一覧表示
- ドラッグ&ドロップでのファイルアップロード
- 書類カテゴリー分類
- バージョン管理

#### 3.4.2 コミュニケーション履歴
- メール履歴の自動取込
- 電話メモの記録
- 面談記録
- 時系列での一覧表示

#### 3.4.3 関係者管理
**管理対象**
- 依頼者（複数可）
- 相手方（複数可）
- 裁判官
- 相手方代理人
- 証人
- その他関係者

**管理項目**
- 氏名・連絡先
- 役割
- メモ
- コミュニケーション履歴

### 3.5 レポート・分析

#### 3.5.1 ダッシュボード
**表示項目**
- 案件総数（ステータス別）
- 担当案件数（弁護士別）
- 今週の期限案件
- 最近更新された案件
- 滞留案件アラート

#### 3.5.2 レポート出力
**出力可能レポート**
- 案件一覧（Excel/PDF）
- 進捗レポート
- 担当者別ワークロード
- 月次/年次統計

## 4. 非機能要件

### 4.1 パフォーマンス
- 案件一覧表示: 1000件表示で2秒以内
- カンバンボード表示: 200カードで1秒以内
- 検索レスポンス: 0.5秒以内
- 同時接続: 50ユーザー

### 4.2 ユーザビリティ
- 直感的なUI（学習時間30分以内）
- レスポンシブデザイン（タブレット対応）
- キーボードショートカット対応
- 多言語対応（日本語・英語）

### 4.3 セキュリティ
- 案件ごとのアクセス権限設定
- 操作ログの記録
- データの暗号化
- セッション管理

## 5. UI/UX設計

### 5.1 画面構成

#### 5.1.1 案件一覧画面
```
┌─────────────────────────────────────────────────────┐
│ [🔍 検索バー] [フィルター▼] [+ 新規案件]            │
├─────────────────────────────────────────────────────┤
│ □ 案件番号 ↓ | 案件名 | 依頼者 | ステータス | 担当  │
│ □ 2024-001  | ○○訴訟 | 山田氏 | 進行中    | 田中  │
│ □ 2024-002  | △△調停 | 鈴木氏 | 準備中    | 佐藤  │
│ ...                                                  │
└─────────────────────────────────────────────────────┘
```

#### 5.1.2 カンバンボード
```
┌─────────────────────────────────────────────────────┐
│ [👤 担当者] [📁 種別] [🔍 検索]  [⚙️ 表示設定]       │
├────────┬────────┬────────┬────────┬────────────────┤
│受任前  │準備中  │進行中  │和解中  │完了            │
├────────┼────────┼────────┼────────┼────────────────┤
│┌──────┐│┌──────┐│┌──────┐│┌──────┐│                │
││2024- ││2024- ││2024- ││2024- ││                │
││001   ││003   ││002   ││004   ││                │
││山田訴訟││鈴木案件││田中調停││佐藤和解││                │
│└──────┘│└──────┘│└──────┘│└──────┘│                │
│        │┌──────┐│        │        │                │
│        ││2024- ││        │        │                │
│        ││005   ││        │        │                │
│        ││高橋案件││        │        │                │
│        │└──────┘│        │        │                │
└────────┴────────┴────────┴────────┴────────────────┘
```

#### 5.1.3 案件詳細画面
```
┌─────────────────────────────────────────────────────┐
│ ← 戻る  案件番号: 2024-001  [編集] [アクション▼]    │
├─────────────────────────────────────────────────────┤
│ ┌─────────────┐ ┌─────────────────────────────┐   │
│ │ 基本情報    │ │ 山田 対 株式会社ABC 訴訟      │   │
│ │             │ │ ステータス: 進行中            │   │
│ │ 依頼者:     │ │ 担当: 田中弁護士、鈴木事務員  │   │
│ │ 山田太郎    │ │ 次回期日: 2024/02/15         │   │
│ │             │ └─────────────────────────────┘   │
│ │ 相手方:     │ ┌─────────────────────────────┐   │
│ │ 株式会社ABC │ │ 📑 関連書類 | 💬 履歴 | ✓ タスク│   │
│ └─────────────┘ │ ├─────────────────────────────┤   │
│                 │ │ 訴状.pdf          2024/01/10│   │
│ [タイムライン] │ │ 答弁書.pdf        2024/01/20│   │
│ 2024/01/25     │ │ 準備書面1.pdf     2024/02/01│   │
│ ステータス変更 │ └─────────────────────────────┘   │
│ → 進行中       │                                   │
└─────────────────────────────────────────────────────┘
```

### 5.2 操作フロー

#### 5.2.1 新規案件作成フロー
1. 案件一覧画面で「新規案件」ボタンをクリック
2. 基本情報入力画面表示
3. 必須項目入力
4. 「保存」または「保存して詳細画面へ」選択
5. 確認ダイアログ表示
6. 作成完了

#### 5.2.2 ステータス変更フロー
1. カンバンボードでカードを選択
2. 目的のステータス列にドラッグ
3. 必要に応じて確認ダイアログ
4. ステータス変更完了
5. 関係者への通知（設定による）

## 6. データモデル

### 6.1 主要エンティティ

#### Case（案件）
```sql
CREATE TABLE cases (
    id UUID PRIMARY KEY,
    case_number VARCHAR(50) UNIQUE NOT NULL,
    title VARCHAR(255) NOT NULL,
    case_type VARCHAR(50) NOT NULL,
    client_id UUID NOT NULL,
    opponent_name VARCHAR(255),
    status VARCHAR(50) NOT NULL,
    accepted_date DATE NOT NULL,
    closed_date DATE,
    summary TEXT,
    -- 共通カラム
    created_at TIMESTAMP NOT NULL,
    created_by UUID NOT NULL,
    updated_at TIMESTAMP NOT NULL,
    updated_by UUID NOT NULL,
    deleted_at TIMESTAMP,
    version INTEGER NOT NULL DEFAULT 0
);
```

#### CaseStatus（案件ステータス）
```sql
CREATE TABLE case_statuses (
    id UUID PRIMARY KEY,
    case_id UUID NOT NULL,
    status VARCHAR(50) NOT NULL,
    changed_at TIMESTAMP NOT NULL,
    changed_by UUID NOT NULL,
    comment TEXT,
    FOREIGN KEY (case_id) REFERENCES cases(id)
);
```

#### CaseAssignment（案件担当者）
```sql
CREATE TABLE case_assignments (
    id UUID PRIMARY KEY,
    case_id UUID NOT NULL,
    user_id UUID NOT NULL,
    role VARCHAR(50) NOT NULL, -- 'lawyer', 'clerk'
    assigned_at TIMESTAMP NOT NULL,
    assigned_by UUID NOT NULL,
    is_primary BOOLEAN DEFAULT FALSE,
    FOREIGN KEY (case_id) REFERENCES cases(id),
    FOREIGN KEY (user_id) REFERENCES users(id)
);
```

## 7. API仕様

### 7.1 エンドポイント一覧

#### 案件管理
- `GET /api/v1/cases` - 案件一覧取得
- `POST /api/v1/cases` - 案件作成
- `GET /api/v1/cases/{id}` - 案件詳細取得
- `PUT /api/v1/cases/{id}` - 案件更新
- `DELETE /api/v1/cases/{id}` - 案件削除（論理削除）

#### ステータス管理
- `PUT /api/v1/cases/{id}/status` - ステータス変更
- `GET /api/v1/cases/{id}/status-history` - ステータス履歴取得

#### タスク管理
- `GET /api/v1/cases/{id}/tasks` - タスク一覧取得
- `POST /api/v1/cases/{id}/tasks` - タスク作成
- `PUT /api/v1/tasks/{id}` - タスク更新
- `DELETE /api/v1/tasks/{id}` - タスク削除

### 7.2 リクエスト/レスポンス例

#### 案件作成
```json
// Request
POST /api/v1/cases
{
  "caseNumber": "2024-001",
  "title": "山田太郎 対 株式会社ABC 損害賠償請求事件",
  "caseType": "civil",
  "clientId": "123e4567-e89b-12d3-a456-426614174000",
  "opponentName": "株式会社ABC",
  "acceptedDate": "2024-01-10",
  "summary": "契約違反による損害賠償請求",
  "assignments": [
    {
      "userId": "123e4567-e89b-12d3-a456-426614174001",
      "role": "lawyer",
      "isPrimary": true
    }
  ]
}

// Response
{
  "data": {
    "id": "123e4567-e89b-12d3-a456-426614174002",
    "caseNumber": "2024-001",
    "title": "山田太郎 対 株式会社ABC 損害賠償請求事件",
    "status": "preparation",
    "createdAt": "2024-01-10T10:00:00Z"
  }
}
```

## 8. 権限設計

### 8.1 ロール別権限

#### 弁護士（Lawyer）
- 全案件の参照・編集
- ステータス変更
- 担当者割当
- 案件終了処理

#### 事務員（Clerk）
- 担当案件の参照・編集
- 限定的なステータス変更
- タスク管理
- 書類アップロード

#### 管理者（Admin）
- システム設定
- ユーザー管理
- 全権限

### 8.2 データアクセス制御
- 案件ごとのアクセス権限設定
- 機密レベルによる表示制御
- 操作ログの記録

## 9. 移行計画

### 9.1 既存データの移行
- Excelファイルからの一括インポート
- CSVフォーマットの定義
- データクレンジング
- 移行テスト

### 9.2 段階的導入
1. パイロット運用（特定の部署）
2. フィードバック収集
3. 改善実施
4. 全社展開

## 10. 今後の拡張予定

### 10.1 AI機能
- 類似案件の自動提案
- 進捗予測
- リスク分析

### 10.2 外部連携
- 裁判所システムとの連携
- 会計システムとの統合
- カレンダー連携

### 10.3 モバイル対応
- ネイティブアプリ開発
- プッシュ通知
- オフライン対応