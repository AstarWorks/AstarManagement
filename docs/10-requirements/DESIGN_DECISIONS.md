# 設計決定事項

## 1. 案件番号
- **形式**: YYYY-MM-NNN（例：2024-01-001）
- **採番**: 月ごとにリセット
- **桁数**: 3桁から開始、設定で変更可能
- **一意性**: システム全体でユニーク

## 2. タグシステム
- **統一設計**: すべて（ステータス、優先度、種別など）をタグとして統一管理
- **カテゴリー**: 
  - ステータス（排他的・必須）
  - 優先度（排他的）
  - 案件種別（複数選択可）
  - 一般（自由タグ）
- **表記ゆれ**: 別タグとして扱う
- **色設定**: 全員が編集可能
- **削除**: 物理削除（フロント側で警告）

## 3. マルチテナント
- **データ分離**: Row Level Security (RLS)
- **テナント識別**: サブドメイン + ログイン後選択可能
- **データ共有**: テンプレート共有機能あり

## 4. 担当者管理
- **種類**: 弁護士、事務員、AI（3種類）
- **複数割当**: 可能（制限なし）
- **変更通知**: 必要（変更理由も記録）
- **アクセス権**: 過去の担当者はアクセス不可

## 5. 権限システム
- **Discord風RBAC**: パーミッションベース
- **ロール継承**: 親子関係あり（事務員→弁護士）
- **複数ロール**: ユーザーは複数ロール保持可能
- **優先順位**: priorityで管理

## 6. 検索機能
- **モード**: 部分一致デフォルト、完全一致/正規表現も可能
- **論理演算**: AND/OR切り替え可能（Google風構文）
- **対象**: すべてのフィールド（案件情報、タグ、メモなど）
- **ハイライト**: フロントエンドで処理

## 7. UI/UX
- **フレームワーク**: Nuxt 4（SPA、CSRモード）
- **表示モード**: テーブル/カード/リスト（テーブル優先）
- **ページネーション**: 番号付き、表示件数選択可能
- **リアルタイム更新**: 不要
- **フィルター**: フロントでリアルタイム、詳細検索はサーバー

## 8. 技術選定
- **フロントエンド**: Nuxt 4、Vue 3、TypeScript、Tailwind CSS
- **バックエンド**: Spring Boot 3.x、Kotlin、Java 21
- **データベース**: PostgreSQL 15（Supabase）
- **認証**: JWT（アクセストークン15分、リフレッシュトークン7日）

## 9. 設計原則
- **Simple over Easy**: VueUseなどを活用してシンプルに
- **拡張性重視**: 将来のAR統合、AIエージェント操作を視野に
- **パフォーマンス**: 業務ツールとして爆速動作が必須
- **段階的実装**: 本質的な4つの課題解決を優先
- **ライブラリ優先**: 自作を避け、既存ライブラリを積極活用

## 10. カンバンボード設計
- **ドラッグ&ドロップ**: @vueuse/draggableを使用
- **視覚フィードバック**: ドラッグ中は半透明、ドロップ可能領域をハイライト
- **ビュー切り替え**: カンバン/テーブルをワンクリックで切り替え
- **権限制御**: ドラッグ可否を権限でチェック、不可の場合は視覚的に強調（鍵アイコン表示）
- **モバイル対応**: タッチ操作も対応（軽量実装）、長押しでドラッグ開始
- **アニメーション**: VueUseのuseTransitionでシンプル実装（将来的にリッチ化）
- **ドラッグ表示**: プレースホルダー表示（ドラッグ元の場所を確保）
- **カード情報優先度**: 
  1. 案件番号
  2. 案件名
  3. 優先度タグ
  4. 担当者アバター
  5. 期限（近い場合は強調）
  6. その他タグ（2-3個まで）

## 11. 案件詳細画面設計
- **編集方式**: インライン編集（Notion風）
- **保存方式**: 自動保存（デバウンス500ms）
- **保存状態表示**: 保存中・保存済み・エラーの3状態
- **Optimistic UI**: 即座にUI更新、バックグラウンドで保存
- **タブ構成**: 基本情報、タイムライン、書類、担当者、メモ、関連案件
- **タブ優先順位**: 
  1. 基本情報
  2. タイムライン
  3. 書類
  4. 担当者
  5. メモ
  6. 関連案件

## 12. タグ管理画面設計
- **カテゴリー別表示**: タグをカテゴリー別にグループ化して表示
- **ドラッグ&ドロップ**: @vueuse/integrations/useSortableで優先順位変更
- **インライン色編集**: カラーピッカーでタグの色を即座に変更
- **使用状況可視化**: 各タグの使用案件数を表示、未使用タグの確認
- **権限制御**: tag.manage権限でアクセス制御、tag.reorder権限で並び替え
- **プリセットカラー**: 20色のプリセット + カスタムカラー入力
- **削除制限**: 使用中のタグは削除不可（視覚的に明示）
- **統計ダッシュボード**: 人気タグTOP10、未使用タグ一覧