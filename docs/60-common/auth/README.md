# 認証・セキュリティ設計

このディレクトリには、汎用ビジネス管理プラットフォームの認証システムとセキュリティ関連の設計書が含まれています。

## 📋 ドキュメント一覧

### コア設計書（Auth0委託対応）
- **[auth0-integration-architecture.md](./auth0-integration-architecture.md)** - **Auth0委託認証アーキテクチャ**
- **[auth0-configuration-guide.md](./auth0-configuration-guide.md)** - **Auth0設定ガイド**
- **[dynamic-role-system-design.md](./dynamic-role-system-design.md)** - Discord風動的ロールシステム（Auth0連携）
- **[auth-database-design.md](./auth-database-design.md)** - 認証データベース設計（簡素化版）
- **[permission-system-design.md](./permission-system-design.md)** - 権限管理システム設計概要

### アーカイブ
- **[archived/](./archived/)** - 旧版・参考資料

## 🎯 設計思想（Auth0委託アプローチ）

### 開発速度最優先 + 汎用プラットフォーム
- **認証委託**: Auth0に認証処理を完全委託、開発速度3-4週間短縮
- **業界非依存**: 特定業界用語を使用しない完全汎用設計
- **動的システム**: 事前定義ロール・権限なし、完全カスタマイズ
- **権限システム継続**: 柔軟な権限管理機能は自社実装で維持
- **テンプレート活用**: 業界特化要素は外部テンプレートで提供

## 🔧 技術仕様

### Auth0委託認証アーキテクチャ
- **フロントエンド**: Nuxt.js 3 + Sidebase Auth + Auth0 Provider
- **認証処理**: Auth0（完全委託）
- **バックエンド**: Spring Boot（JWT検証+認可のみ）
- **データベース**: PostgreSQL（大幅簡素化）
- **セッション管理**: Sidebase Auth（Auth.js基盤）+ Auth0連携
- **認証プロバイダー**: Auth0経由でLocal、OAuth2、SAML統一対応

### ハイブリッドマルチテナンシー（継続）
- **Starter**: Shared DB + Row Level Security  
- **Professional**: Dedicated Schema per Tenant
- **Enterprise**: Dedicated Container per Tenant

### Auth0委託認証フロー
1. クライアントからAuth0リダイレクト
2. Auth0が認証実行（Local/Social/Enterprise）
3. 成功時にCustom Claims付きJWT発行（テナント・ロール情報含む）
4. Spring BootでJWT検証のみ実行
5. 権限チェック（既存システム継続）+ RLSでデータアクセス制御

## 🔐 セキュリティ原則

1. **最小権限の原則** - 必要最小限の権限のみ付与
2. **多層防御** - UI・API・ビジネスロジック・データベース各層での保護
3. **ゼロトラスト** - すべてのアクセスを検証、継続的権限チェック
4. **監査証跡** - 包括的なログ・証跡管理
5. **データ暗号化** - 保存時・転送時の暗号化

## 🏗️ Auth0委託アーキテクチャ概要

```
┌─────────────────────────────────────────────────────────────┐
│                    Frontend Layer                          │
│    Nuxt.js 3 + Sidebase Auth + Auth0 Provider             │
└─────────────────────┬───────────────────────────────────────┘
                      │ Auth0 Redirect
┌─────────────────────┴───────────────────────────────────────┐
│                   Auth0 (SaaS)                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────┐     │
│  │   Local     │  │   Social    │  │   Enterprise   │     │
│  │   Auth      │  │   Login     │  │   SSO (SAML)   │     │
│  └─────────────┘  └─────────────┘  └─────────────────┘     │
│           │                │                │               │
│  ┌─────────────────────────────────────────────────────┐   │
│  │     JWT Token 発行・管理（Custom Claims付き）        │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────┬───────────────────────────────────────┘
                      │ JWT Bearer Token
┌─────────────────────┴───────────────────────────────────────┐
│              Spring Boot (軽量化)                           │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────┐     │
│  │ JWT検証     │  │ 権限チェック │  │ テナント管理     │     │
│  │ (Auth0専用) │  │ (既存継続)  │  │ (既存継続)     │     │
│  └─────────────┘  └─────────────┘  └─────────────────┘     │
└─────────────────────┬───────────────────────────────────────┘
                      │
┌─────────────────────┴───────────────────────────────────────┐
│                PostgreSQL (簡素化)                         │
│   roles, permissions, tenants (認証テーブル大幅削除)        │
└─────────────────────────────────────────────────────────────┘
```

## 🚀 主要機能

### 動的ロールシステム
- 事前定義ロールなし、完全動的作成
- Discord風の色分け・複数ロール付与
- テンプレートロールインポート機能

### 柔軟権限システム
- リソースベース動的権限生成
- フィールドレベル・条件指定アクセス制御
- own/team/workspace/all のスコープ管理

### Auth0委託エンタープライズセキュリティ
- Auth0の多要素認証（TOTP/SMS/Email/WebAuthn）
- Auth0のセッション管理・デバイス追跡・Attack Protection
- Auth0 + アプリケーション統合監視

## 🔗 関連ドキュメント
- [API仕様](../01-api-specifications/)
- [データベース設計](../03-database-design/)
- [システム設計](../05-system-design/)