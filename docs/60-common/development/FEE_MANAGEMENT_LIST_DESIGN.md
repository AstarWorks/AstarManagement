# å ±é…¬ç®¡ç†ç”»é¢ - çµŒè²»ä¸€è¦§è¡¨ç¤ºè¨­è¨ˆ

## çµŒè²»ä¸€è¦§ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¡¨ç¤ºï¼ˆçµ±åˆãƒ“ãƒ¥ãƒ¼ï¼‰

### 1. è¡¨ç¤ºæ§‹æˆ

çµŒè²»ä¸€è¦§ç”»é¢ã§ã¯ã€å¼è­·å£«ãŒæœ€ã‚‚å¿…è¦ã¨ã™ã‚‹æƒ…å ±ã‚’1ç”»é¢ã§ç¢ºèªã§ãã‚‹çµ±åˆãƒ“ãƒ¥ãƒ¼ã‚’æ¡ç”¨ã—ã¾ã™ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ çµŒè²»ä¸€è¦§                                [æœˆé¸æŠ] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š ä»Šæœˆã®ã‚µãƒãƒªãƒ¼                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ åå…¥: Â¥1,234,567  æ”¯å‡º: Â¥456,789          â”‚ â”‚
â”‚ â”‚ å·®é¡: Â¥777,778 (å‰æœˆæ¯” +12.5%)             â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚
â”‚ ğŸ“ ä»Šæ—¥å…¥åŠ›ã—ãŸå®Ÿè²»                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 14:30 ã‚¿ã‚¯ã‚·ãƒ¼ä»£      Â¥1,200  æ¡ˆä»¶:2024-001â”‚ â”‚
â”‚ â”‚ 11:20 åå…¥å°ç´™ä»£    Â¥10,000  æ¡ˆä»¶:2024-002â”‚ â”‚
â”‚ â”‚ 09:15 äº¤é€šè²»          Â¥540   æ¡ˆä»¶:2024-001â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                        ã‚‚ã£ã¨è¦‹ã‚‹ â†’              â”‚
â”‚                                                 â”‚
â”‚ âš ï¸ æœªè«‹æ±‚ã®å®Ÿè²»                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ æ¡ˆä»¶:2024-001 ã€‡ã€‡å•†äº‹ vs â–³â–³å·¥æ¥­          â”‚ â”‚
â”‚ â”‚   å®Ÿè²»åˆè¨ˆ: Â¥35,740 (5ä»¶)                  â”‚ â”‚
â”‚ â”‚   æœ€å¤: 2024/01/05 (15æ—¥çµŒé)              â”‚ â”‚
â”‚ â”‚                                            â”‚ â”‚
â”‚ â”‚ æ¡ˆä»¶:2024-002 åŠ´åƒå¯©åˆ¤äº‹ä»¶                  â”‚ â”‚
â”‚ â”‚   å®Ÿè²»åˆè¨ˆ: Â¥52,000 (3ä»¶)                  â”‚ â”‚
â”‚ â”‚   æœ€å¤: 2024/01/10 (10æ—¥çµŒé)              â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                 ã™ã¹ã¦ã®æœªè«‹æ±‚ã‚’è¦‹ã‚‹ â†’           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è©³ç´°

#### 2.1 ä»Šæœˆã®ã‚µãƒãƒªãƒ¼
```typescript
interface MonthlySummary {
  income: number          // åå…¥åˆè¨ˆ
  expense: number         // æ”¯å‡ºåˆè¨ˆ
  balance: number         // å·®é¡
  previousBalance: number // å‰æœˆã®å·®é¡
  trend: {
    value: number         // å‰æœˆæ¯”ï¼ˆï¼…ï¼‰
    direction: 'up' | 'down' | 'flat'
  }
}
```

**è¡¨ç¤ºå†…å®¹ï¼š**
- å¤§ããè¦‹ã‚„ã™ã„é‡‘é¡è¡¨ç¤º
- å‰æœˆæ¯”ã‚’ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸ã§è¡¨ç¤º
- ãƒˆãƒ¬ãƒ³ãƒ‰ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆâ†‘â†“â†’ï¼‰

#### 2.2 ä»Šæ—¥å…¥åŠ›ã—ãŸå®Ÿè²»
```typescript
interface TodayExpenses {
  expenses: Expense[]     // ä»Šæ—¥ã®å®Ÿè²»ï¼ˆæœ€æ–°5ä»¶ï¼‰
  totalCount: number      // ä»Šæ—¥ã®ç·ä»¶æ•°
  totalAmount: number     // ä»Šæ—¥ã®åˆè¨ˆé‡‘é¡
}
```

**è¡¨ç¤ºå†…å®¹ï¼š**
- æ™‚åˆ»ãƒ»æ‘˜è¦ãƒ»é‡‘é¡ãƒ»æ¡ˆä»¶ç•ªå·
- æœ€æ–°5ä»¶ã¾ã§è¡¨ç¤º
- ãã‚Œä»¥ä¸Šã‚ã‚‹å ´åˆã¯ã€Œã‚‚ã£ã¨è¦‹ã‚‹ã€ãƒªãƒ³ã‚¯
- ç©ºã®å ´åˆã¯ã€Œä»Šæ—¥ã¯ã¾ã å®Ÿè²»ãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€

#### 2.3 æœªè«‹æ±‚ã®å®Ÿè²»
```typescript
interface UnbilledExpenses {
  byCase: Array<{
    caseId: string
    caseNumber: string
    caseTitle: string
    clientName: string
    expenses: Expense[]
    totalAmount: number
    oldestDate: string
    daysElapsed: number
  }>
}
```

**è¡¨ç¤ºå†…å®¹ï¼š**
- æ¡ˆä»¶ã”ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
- åˆè¨ˆé‡‘é¡ã®å¤šã„é †ã«ä¸Šä½3æ¡ˆä»¶ã‚’è¡¨ç¤º
- æœ€å¤ã®å®Ÿè²»ã‹ã‚‰ã®çµŒéæ—¥æ•°ã‚’è¡¨ç¤ºï¼ˆè«‹æ±‚æ¼ã‚Œé˜²æ­¢ï¼‰
- ã‚¯ãƒªãƒƒã‚¯ã§è©²å½“æ¡ˆä»¶ã®å®Ÿè²»ä¸€è¦§ã¸

### 3. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ

#### ExpenseListViewï¼ˆãƒ¡ã‚¤ãƒ³ãƒ“ãƒ¥ãƒ¼ï¼‰
```vue
<template>
  <div class="expense-list-view">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="list-header">
      <h2 class="text-lg font-semibold">çµŒè²»ä¸€è¦§</h2>
      <MonthPicker v-model="selectedMonth" />
    </div>
    
    <!-- ä»Šæœˆã®ã‚µãƒãƒªãƒ¼ -->
    <section class="summary-section">
      <h3 class="section-title">
        <TrendingUp class="h-4 w-4" />
        ä»Šæœˆã®ã‚µãƒãƒªãƒ¼
      </h3>
      <MonthlySummaryCard :data="monthlySummary" />
    </section>
    
    <!-- ä»Šæ—¥å…¥åŠ›ã—ãŸå®Ÿè²» -->
    <section class="today-section">
      <h3 class="section-title">
        <FileText class="h-4 w-4" />
        ä»Šæ—¥å…¥åŠ›ã—ãŸå®Ÿè²»
      </h3>
      <div v-if="todayExpenses.expenses.length" class="expense-list">
        <TodayExpenseItem
          v-for="expense in todayExpenses.expenses"
          :key="expense.id"
          :expense="expense"
          @click="editExpense(expense)"
        />
        <Button
          v-if="todayExpenses.totalCount > 5"
          variant="ghost"
          class="w-full"
          @click="showAllToday"
        >
          ã‚‚ã£ã¨è¦‹ã‚‹ï¼ˆæ®‹ã‚Š{{ todayExpenses.totalCount - 5 }}ä»¶ï¼‰
          <ChevronRight class="h-4 w-4 ml-1" />
        </Button>
      </div>
      <EmptyState v-else>
        ä»Šæ—¥ã¯ã¾ã å®Ÿè²»ãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“
      </EmptyState>
    </section>
    
    <!-- æœªè«‹æ±‚ã®å®Ÿè²» -->
    <section class="unbilled-section">
      <h3 class="section-title">
        <AlertCircle class="h-4 w-4 text-warning" />
        æœªè«‹æ±‚ã®å®Ÿè²»
      </h3>
      <div v-if="unbilledExpenses.byCase.length" class="unbilled-list">
        <UnbilledCaseCard
          v-for="caseData in unbilledExpenses.byCase.slice(0, 3)"
          :key="caseData.caseId"
          :data="caseData"
          @click="showCaseExpenses(caseData.caseId)"
          @create-invoice="createInvoiceForCase(caseData.caseId)"
        />
        <Button
          v-if="unbilledExpenses.byCase.length > 3"
          variant="outline"
          class="w-full"
          @click="showAllUnbilled"
        >
          ã™ã¹ã¦ã®æœªè«‹æ±‚ã‚’è¦‹ã‚‹ï¼ˆ{{ unbilledExpenses.byCase.length }}æ¡ˆä»¶ï¼‰
          <ChevronRight class="h-4 w-4 ml-1" />
        </Button>
      </div>
      <EmptyState v-else variant="success">
        <CheckCircle class="h-8 w-8 text-green-600 mb-2" />
        ã™ã¹ã¦ã®å®Ÿè²»ãŒè«‹æ±‚æ¸ˆã¿ã§ã™
      </EmptyState>
    </section>
  </div>
</template>

<script setup lang="ts">
// å®Ÿè£…
const selectedMonth = ref(getCurrentMonth())
const { monthlySummary, todayExpenses, unbilledExpenses } = useExpenseListData(selectedMonth)

// ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
const showAllToday = () => {
  // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ã€Œä»Šæ—¥ã€ã«è¨­å®šã—ã¦è©³ç´°ç”»é¢ã¸
  navigateTo('/expenses/list?filter=today')
}

const showAllUnbilled = () => {
  // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ã€Œæœªè«‹æ±‚ã€ã«è¨­å®šã—ã¦è©³ç´°ç”»é¢ã¸
  navigateTo('/expenses/list?filter=unbilled')
}

const showCaseExpenses = (caseId: string) => {
  // ç‰¹å®šæ¡ˆä»¶ã®å®Ÿè²»ä¸€è¦§ã¸
  navigateTo(`/expenses/list?caseId=${caseId}`)
}

const createInvoiceForCase = (caseId: string) => {
  // è«‹æ±‚æ›¸ä½œæˆç”»é¢ã¸é·ç§»
  navigateTo(`/invoices/new?caseId=${caseId}&type=expenses`)
}
</script>

<style scoped>
.expense-list-view {
  @apply space-y-6;
}

.list-header {
  @apply flex items-center justify-between;
}

.section-title {
  @apply flex items-center gap-2 text-sm font-medium text-muted-foreground mb-3;
}

.summary-section {
  @apply bg-muted/30 rounded-lg p-4;
}

.expense-list {
  @apply space-y-2;
}

.unbilled-list {
  @apply space-y-3;
}
</style>
```

#### TodayExpenseItemï¼ˆä»Šæ—¥ã®å®Ÿè²»ã‚¢ã‚¤ãƒ†ãƒ ï¼‰
```vue
<template>
  <div class="today-expense-item">
    <span class="time">{{ formatTime(expense.createdAt) }}</span>
    <span class="description">{{ expense.description }}</span>
    <span class="amount">Â¥{{ expense.amount.toLocaleString() }}</span>
    <span class="case-number">{{ expense.caseNumber }}</span>
  </div>
</template>

<style scoped>
.today-expense-item {
  @apply flex items-center gap-3 p-2 rounded hover:bg-accent cursor-pointer;
}

.time {
  @apply text-sm text-muted-foreground w-12;
}

.description {
  @apply flex-1 truncate;
}

.amount {
  @apply font-mono font-medium;
}

.case-number {
  @apply text-sm text-muted-foreground;
}
</style>
```

#### UnbilledCaseCardï¼ˆæœªè«‹æ±‚æ¡ˆä»¶ã‚«ãƒ¼ãƒ‰ï¼‰
```vue
<template>
  <Card class="unbilled-case-card">
    <CardContent class="p-4">
      <div class="case-header">
        <div>
          <div class="case-number">{{ data.caseNumber }}</div>
          <div class="case-title">{{ data.caseTitle }}</div>
        </div>
        <Button
          size="sm"
          variant="outline"
          @click.stop="$emit('create-invoice')"
        >
          è«‹æ±‚æ›¸ä½œæˆ
        </Button>
      </div>
      
      <div class="case-stats">
        <div class="stat">
          <span class="label">å®Ÿè²»åˆè¨ˆ</span>
          <span class="value">Â¥{{ data.totalAmount.toLocaleString() }}</span>
          <span class="count">({{ data.expenses.length }}ä»¶)</span>
        </div>
        <div class="stat">
          <span class="label">æœ€å¤</span>
          <span class="value">{{ formatDate(data.oldestDate) }}</span>
          <span class="days text-warning">{{ data.daysElapsed }}æ—¥çµŒé</span>
        </div>
      </div>
    </CardContent>
  </Card>
</template>

<style scoped>
.unbilled-case-card {
  @apply cursor-pointer hover:shadow-md transition-shadow;
}

.case-header {
  @apply flex items-start justify-between mb-3;
}

.case-number {
  @apply font-medium;
}

.case-title {
  @apply text-sm text-muted-foreground;
}

.case-stats {
  @apply flex gap-6;
}

.stat {
  @apply flex items-baseline gap-1;
}

.label {
  @apply text-xs text-muted-foreground;
}

.value {
  @apply font-medium;
}

.count, .days {
  @apply text-xs;
}

.text-warning {
  @apply text-orange-600 dark:text-orange-400;
}
</style>
```

### 4. ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ­ã‚¸ãƒƒã‚¯

```typescript
// composables/useExpenseListData.ts
export const useExpenseListData = (month: Ref<string>) => {
  const { expenses } = useExpensesStore()
  
  // ä»Šæœˆã®ã‚µãƒãƒªãƒ¼
  const monthlySummary = computed(() => {
    const filtered = expenses.value.filter(e => 
      e.date.startsWith(month.value)
    )
    
    const income = filtered
      .filter(e => e.accountCode === 'sales')
      .reduce((sum, e) => sum + e.amount, 0)
      
    const expense = filtered
      .filter(e => e.accountCode !== 'sales')
      .reduce((sum, e) => sum + e.amount, 0)
      
    // å‰æœˆã®ãƒ‡ãƒ¼ã‚¿ã¨æ¯”è¼ƒ
    // ...
    
    return {
      income,
      expense,
      balance: income - expense,
      trend: calculateTrend(currentBalance, previousBalance)
    }
  })
  
  // ä»Šæ—¥å…¥åŠ›ã—ãŸå®Ÿè²»
  const todayExpenses = computed(() => {
    const today = new Date().toISOString().split('T')[0]
    const filtered = expenses.value.filter(e => 
      e.createdAt.startsWith(today)
    )
    
    return {
      expenses: filtered.slice(0, 5),
      totalCount: filtered.length,
      totalAmount: filtered.reduce((sum, e) => sum + e.amount, 0)
    }
  })
  
  // æœªè«‹æ±‚ã®å®Ÿè²»
  const unbilledExpenses = computed(() => {
    const unbilled = expenses.value.filter(e => 
      !e.invoiceId && e.expenseType === 'case'
    )
    
    // æ¡ˆä»¶ã”ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
    const grouped = groupBy(unbilled, 'caseId')
    
    // å„æ¡ˆä»¶ã®é›†è¨ˆ
    const byCase = Object.entries(grouped).map(([caseId, expenses]) => {
      const oldestDate = min(expenses.map(e => e.date))
      const daysElapsed = differenceInDays(new Date(), new Date(oldestDate))
      
      return {
        caseId,
        caseNumber: expenses[0].caseNumber,
        caseTitle: expenses[0].caseTitle,
        clientName: expenses[0].clientName,
        expenses,
        totalAmount: expenses.reduce((sum, e) => sum + e.amount, 0),
        oldestDate,
        daysElapsed
      }
    })
    
    // é‡‘é¡ã®å¤šã„é †ã«ã‚½ãƒ¼ãƒˆ
    return {
      byCase: byCase.sort((a, b) => b.totalAmount - a.totalAmount)
    }
  })
  
  return {
    monthlySummary,
    todayExpenses,
    unbilledExpenses
  }
}
```