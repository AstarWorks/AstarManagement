# M1-T7 – Controller Integration Tests

## Goal
Add Spring Boot integration tests exercising the new editor controllers (folders/documents) under the feature toggle, ensuring request validation, security guards, CRUD flows, and error envelopes behave as expected.

## Planned Steps
1. Create MockMvc-based integration tests in `backend/src/test/kotlin/com/astarworks/astarmanagement/integration/editor/api/` using existing `IntegrationTestBase` utilities.
2. Seed tenants/workspaces/documents as fixtures; leverage `TenantContextService` to simulate authenticated requests.
3. Cover happy paths (create/update/list/breadcrumb, list revisions) and error cases (not found, invalid operations, permission failure if possible).
4. Assert responses follow the `EditorApiResponse` envelope with proper `success/data/error/timestamp` semantics.
5. Update documentation/context files with test coverage notes and rerun `./gradlew test`.

## Notes
- Feature flag must be enabled via test configuration (set `app.features.editor.enabled=true`).
- Security: reuse `@WithMockUser` or custom `AuthenticatedUserContext` principal injection to satisfy `@PreAuthorize` checks, or temporarily mock `AuthorizationService`.
- Consider using SQL fixtures (Flyway) from prior tasks to reduce duplication.

## Progress
- Implemented `EditorControllerIntegrationTest` exercising folder/document CRUD、パンくず、リビジョン一覧、削除後 404 を MockMvc 経由で検証。テスト毎に `TenantContextService` で RLS 用コンテキストをセット。
- 追加の `EditorSecurityTestConfig` で `TenantAwareJwtAuthenticationConverter` と `AuthorizationProvider` をスタブ化し、JIT プロビジョニングや実パーミッション評価に依存せず成功パス/失敗パスを確認。
- `performJson`/`perform` ヘルパーを用意し、レスポンス本文を伴うアサーションでデバッグ性を確保。`./gradlew test`（ローカル）でグリーンを確認。

## Blockers / Follow-ups
- なし（テストセキュリティのスタブ化で当面の検証要件は満たせている）。
