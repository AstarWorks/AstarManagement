# M1-T5 â€“ Application Services

## Goal
Implement the editor service layer (`DocumentService`, `FolderService`) that orchestrates repositories, enforces tenant/workspace rules, and exposes plaintext CRUD operations.

## Planned Steps
1. Survey existing service patterns (e.g., TableService) for transaction usage, logging, and tenant checks.
2. Define service contracts (method signatures for create/update/move/archive folders, document CRUD + revisions, metadata updates).
3. Implement Kotlin services under `core/editor/domain/service`, injecting repositories and `TenantContextService` where needed.
4. Add supporting utilities/exceptions (slug normalisation, not-found errors) and write targeted unit tests if feasible.
5. Update task notes/contexts; run applicable tests (or document sandbox limitations) before proceeding to controller work.

## Notes
- Services should remain plaintext; encryption hooks will be added in M2.
- Maintain transactional boundaries (`@Transactional`) and ensure tenant/workspace ownership checks.
- Keep dependencies minimal (repositories + tenant context helpers). Controllers are coming in Task 6.

## Progress
- Implemented `DocumentService` with create/update/delete/list operations, slug generation, and metadata upsert logic alongside `DocumentAggregate` domain helper.
- Added `DocumentServiceIntegrationTest` covering document creation, revision updates, metadata changes, revision listing, and delete cascade behaviour.
- Extended `DocumentRevisionNotFoundException` to include a document-scoped factory for clearer error reporting.

## Blockers / Follow-ups
- Gradle integration tests cannot run inside sandbox (`gradle-8.14-bin.zip.lck` permission issue); rerun `./gradlew test --tests '*DocumentServiceIntegrationTest'` locally to verify.
- Consider extracting shared slug/path helpers between folder/document services when refactoring to reduce duplication.
