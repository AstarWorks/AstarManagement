# M1-T2 â€“ Flyway Schema for Editor Service

## Goal
Introduce the database schema required for the editor module by adding Flyway migration(s) for document nodes, revisions, and metadata (plaintext payload for now, encryption columns reserved for M2).

## Planned Steps
1. Review existing migrations and pick the next sequential version number (V026).
2. Design DDL for `document_nodes`, `document_revisions`, and `document_metadata`, including constraints, triggers, and indexes.
3. Create `V026__Create_editor_documents.sql` in `backend/src/main/resources/db/migration` with the schema definition and supporting commentary.
4. Ensure the migration respects multi-tenant constraints (tenant/workspace scoping, path uniqueness) and keeps encryption columns nullable for now.
5. Document progress & blockers in this file; run Flyway validation/build locally when possible.

## Notes
- Reuse `update_updated_at()` trigger where helpful.
- Avoid implementing search indexing tables; they are deferred to preserve search quality.
- Confirm that any new enums/checks align with existing naming conventions.

## Progress
- Added `V026__Create_editor_documents.sql` defining `document_nodes`, `document_revisions`, and `document_metadata` with multi-tenant scopes, constraints, triggers, and deferred encryption columns.
- Enforced path + slug uniqueness, snapshot metadata, and added GIN index on tags for future filtering.
- Applied feature-flag alignment notes (search/indexing remains deferred per milestone).

## Blockers / Follow-ups
- Gradle/Flyway validation not executed due to sandbox Gradle networking/IP restrictions (`Could not determine a usable wildcard IP`). Run `./gradlew flywayMigrate` or full build locally to verify migration ordering.
- Need to revisit CHECK constraint for `materialized_path` once concrete path format is finalized (currently enforces `/segment` style).
